vmserver-db:
  image: mysql:5.6
  container_name: vmserver-db
  volumes:
    - /etc/localtime:/etc/localtime:ro
    - /opt/volumes/mysql/backups:/backups
    - /opt/volumes/mysql/mysql:/var/lib/mysql
  environment:
    - MYSQL_ROOT_PASSWORD=123456
    - MYSQL_DATABASE=vmserver
    - MYSQL_USER=vmserver
    - MYSQL_PASSWORD=vmserver

vmserver-mongodb:
  image: tutum/mongodb:3.2
  container_name: vmserver-mongodb
  volumes:
    - /etc/localtime:/etc/localtime:ro
    - /opt/volumes/mongodb/data:/data/db
  ports:
    - "27017:27017"
    - "28017:28017"
  environment:
    - AUTH=no

vmserver:
  image: zouyapeng/vmserver
  container_name: vmserver
  volumes:
    - /etc/localtime:/etc/localtime:ro
  links:
    - vmserver-db:vmserverdb
  environment:
    - OPENSTACK_AUTH_URL=192.168.213.220
    - C_FORCE_ROOT=true
    - DB_NAME=vmserver
    - DB_USER=vmserver
    - DB_PASSWORD=vmserver
    - MONGODB_HOST=192.168.213.230
    - MONGODB_PORT=27017
    - MONGODB_EXPIRE=2592000

nginx:
  image: zouyapeng/nginx:9339
  container_name: nginx
  volumes:
    - ./nginx/vmserver.template:/etc/nginx/conf.d/vmserver.template
  ports:
    - "9339:9339"
  links:
    - vmserver:vmserver
  environment:
    - VMSERVER=vmserver
  command: /bin/bash -c "envsubst < /etc/nginx/conf.d/vmserver.template > /etc/nginx/conf.d/default.conf && nginx -g 'daemon off;'"